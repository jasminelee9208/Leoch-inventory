<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LBC Inventory</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .logo {
      height: 60px;
    }

    h1 {
      margin: 0;
    }

    .controls {
      margin: 10px 0;
      display: flex;
      gap: 20px;
      align-items: center;
    }

    input[type="text"] {
      padding: 6px;
      width: 220px;
    }

    label {
      font-size: 14px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
      font-size: 14px;
    }

    th {
      background-color: #f2f2f2;
    }

    .right {
      text-align: right;
    }

    .muted {
      color: #666;
      font-size: 13px;
    }
  </style>
</head>

<body>

  <!-- Header -->
  <div class="header">
    <img src="logo.png" alt="Company Logo" class="logo">
    <h1>LBC Inventory</h1>
  </div>

  <div class="muted" id="lastUpdated">Last updated: --</div>

  <!-- Controls -->
  <div class="controls">
    <input type="text" id="search" placeholder="Search part number...">

    <label>
      <input type="checkbox" id="hideZero" checked>
      Auto-hide 0 quantities
    </label>

    <label>
      <input type="checkbox" id="groupPart" checked>
      Group by part number
    </label>
  </div>

  <!-- Table -->
  <table>
    <thead>
      <tr>
        <th>Material</th>
        <th>Part Number</th>
        <th>Location</th>
        <th class="right">Available Qty</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

<script>
fetch("inventory.csv")
  .then(res => res.text())
  .then(text => {
    const lines = text.split("\n").filter(l => l.trim() !== "");

    // Get date from first line
    const dateMatch = lines[0].match(/\((.*?)\)/);
    if (dateMatch) {
      document.getElementById("lastUpdated").innerText =
        "Last updated: " + dateMatch[1];
    }

    // Find header row
    const headerIndex = lines.findIndex(l => l.startsWith("Material"));
    const rows = lines.slice(headerIndex + 1);

    let data = rows.map(r => {
      const cols = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      return {
        material: cols[0],
        part: cols[1],
        location: cols[2],
        qty: parseFloat(cols[3].replace(/,/g, "").replace(/"/g, "")) || 0
      };
    });

    const tableBody = document.getElementById("tableBody");

    function render() {
      tableBody.innerHTML = "";

      const search = document.getElementById("search").value.toLowerCase();
      const hideZero = document.getElementById("hideZero").checked;
      const group = document.getElementById("groupPart").checked;

      let filtered = data.filter(d =>
        d.part.toLowerCase().includes(search) &&
        (!hideZero || d.qty !== 0)
      );

      if (group) {
        const grouped = {};
        filtered.forEach(d => {
          const key = d.part + d.location;
          grouped[key] = grouped[key] || {...d};
          grouped[key].qty += d.qty;
        });
        filtered = Object.values(grouped);
      }

      filtered.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.material}</td>
          <td>${d.part}</td>
          <td>${d.location}</td>
          <td class="right">${d.qty.toLocaleString()}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    document.getElementById("search").addEventListener("input", render);
    document.getElementById("hideZero").addEventListener("change", render);
    document.getElementById("groupPart").addEventListener("change", render);

    render();
  });
</script>

</body>
</html>
