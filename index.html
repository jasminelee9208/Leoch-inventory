<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LBC Inventory</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    th { background: #f2f2f2; }
    input { margin-bottom: 10px; padding: 6px; width: 300px; }
  </style>
</head>
<body>

<h2>LBC Inventory</h2>
<p id="lastUpdated"></p>

<input type="text" id="search" placeholder="Search part number..." onkeyup="filterTable()">

<table id="inventoryTable">
  <thead>
    <tr>
      <th>Material</th>
      <th>Part Number</th>
      <th>Location</th>
      <th>Available Qty</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
fetch("inventory.csv")
  .then(res => res.text())
  .then(text => {
    const lines = text.split("\n").map(l => l.trim()).filter(l => l);

    // --- Extract date from first line ---
    const dateMatch = lines[0].match(/(\d{2}\/\d{2}\/\d{4})/);
    if (dateMatch) {
      document.getElementById("lastUpdated").innerText =
        `Last updated: ${dateMatch[1]}`;
    }

    // --- Find header row ---
    const headerIndex = lines.findIndex(l => l.startsWith("Material,"));
    const dataLines = lines.slice(headerIndex + 1);

    const grouped = {};

    dataLines.forEach(line => {
      const cols = line.split(",");

      // Read ONLY first 4 columns
      const material = cols[0];
      const part = cols[1];
      const location = cols[2];

      // Remove commas + quotes from quantity
      let qty = cols[3].replace(/"/g, "").replace(/,/g, "");
      qty = parseFloat(qty);

      // Hide zero or invalid quantities
      if (!qty || qty === 0) return;

      if (!grouped[part]) grouped[part] = [];
      grouped[part].push({ material, location, qty });
    });

    const tbody = document.querySelector("tbody");
    tbody.innerHTML = "";

    Object.keys(grouped).sort().forEach(part => {
      grouped[part].forEach((row, i) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${i === 0 ? part : ""}</td>
          <td>${row.location}</td>
          <td>${row.qty.toLocaleString()}</td>
        `;

        tbody.appendChild(tr);
      });
    });
  });
</script>


</body>
</html>
